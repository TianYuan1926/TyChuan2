
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>交易日志 · 稳定发行版</title>
  <link rel="stylesheet" href="./styles.css" />
  <!-- Supabase JS (必须) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.45.4/dist/umd/supabase.js"></script>
  <script>
    /* 读取你现有的 APP_CONFIG（在 config 或页面里提前注入）
       如果页面没有 APP_CONFIG，这里提供占位（不会包含任何私密信息） */
    window.APP_CONFIG = window.APP_CONFIG || {
      SUPABASE_URL: "",
      SUPABASE_ANON_KEY: "",
      HCAPTCHA_SITEKEY: "92d48fee-72fc-481a-a0e6-690084662786", /* 你的 sitekey，可被外部覆盖 */
      VERSION: "Stable-Minimal-Release-P8p",
      ENV: "prod"
    };
  </script>
</head>
<body>
  <header class="header">
    <h1>交易日志</h1>
    <div id="status" class="banner"></div>
  </header>

  <main class="wrap">
    <!-- 认证区（未登录显示） -->
    <section id="auth-section" class="card">
      <nav class="tab-row">
        <button class="tab active" data-tab="login">登录</button>
        <button class="tab" data-tab="register">注册</button>
        <button class="tab" data-tab="forgot">忘记密码</button>
      </nav>

      <div id="tab-login" class="tabpane show">
        <form id="login-form" class="grid g2">
          <label>邮箱<input id="login-email" type="email" required /></label>
          <label>密码<input id="login-password" type="password" required /></label>
          <div class="captcha-wrap"><!-- hCaptcha invisible，由 main.js 自动加载 --></div>
          <button type="submit" class="btn">登录</button>
        </form>
      </div>

      <div id="tab-register" class="tabpane">
        <form id="register-form" class="grid g2">
          <label>邮箱<input id="register-email" type="email" required /></label>
          <label>密码<input id="register-password" type="password" required /></label>
          <div class="captcha-wrap"></div>
          <button type="submit" class="btn">注册</button>
        </form>
      </div>

      <div id="tab-forgot" class="tabpane">
        <form id="forgot-form" class="grid g1">
          <label>邮箱<input id="forgot-email" type="email" required /></label>
          <div class="captcha-wrap"></div>
          <button type="submit" class="btn">发送重置邮件</button>
        </form>
      </div>
    </section>

    <!-- 应用区（登录后显示） -->
    <section id="app-section" class="card" style="display:none;">
      <div class="row space-between">
        <h2>我的交易</h2>
        <button id="btn-logout" class="btn">退出登录</button>
      </div>

      <form id="tx-form" class="grid g4">
        <label>时间<input id="tx-ts" type="datetime-local" /></label>
        <label>币种<input id="tx-symbol" placeholder="BTCUSDT" /></label>
        <label>方向
          <select id="tx-side">
            <option value="buy">买入</option>
            <option value="sell">卖出</option>
          </select>
        </label>
        <label>数量<input id="tx-qty" type="number" step="0.00000001" /></label>
        <label>价格<input id="tx-price" type="number" step="0.00000001" /></label>
        <label>手续费<input id="tx-fee" type="number" step="0.00000001" /></label>
        <label class="g-span2">备注<input id="tx-note" /></label>
        <button type="submit" class="btn g-span2">保存记录</button>
      </form>

      <table id="tx-table"></table>
    </section>
  </main>

  <script src="./main.js"></script>
  <script>
    // 简单的 tab 切换（不依赖框架）
    document.addEventListener('click', (e)=>{
      const tab = e.target.closest('.tab');
      if(!tab) return;
      document.querySelectorAll('.tab').forEach(b=>b.classList.remove('active'));
      tab.classList.add('active');
      const name = tab.dataset.tab;
      document.querySelectorAll('.tabpane').forEach(p=>p.classList.remove('show'));
      document.getElementById('tab-'+name)?.classList.add('show');
    });
  </script>
</body>
</html>
